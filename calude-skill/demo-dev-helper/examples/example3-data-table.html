<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户管理 - Data Table</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
        .modal-enter-active, .modal-leave-active {
            transition: opacity 0.3s ease;
        }
        .modal-enter-from, .modal-leave-to {
            opacity: 0;
        }
        .modal-content-enter-active, .modal-content-leave-active {
            transition: transform 0.3s ease;
        }
        .modal-content-enter-from, .modal-content-leave-to {
            transform: scale(0.9);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="container mx-auto px-4 py-8">
        <!-- 页面标题 -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">用户管理</h1>
            <p class="text-gray-600">管理系统用户信息</p>
        </div>

        <!-- 操作栏 -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex flex-col md:flex-row gap-4">
                <!-- 搜索框 -->
                <div class="flex-1">
                    <div class="relative">
                        <input
                            v-model="searchQuery"
                            type="text"
                            placeholder="搜索用户名称或邮箱..."
                            class="w-full border border-gray-300 rounded-lg pl-10 pr-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                        <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                    </div>
                </div>

                <!-- 角色筛选 -->
                <select
                    v-model="filterRole"
                    class="border border-gray-300 rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                    <option value="">全部角色</option>
                    <option value="管理员">管理员</option>
                    <option value="编辑">编辑</option>
                    <option value="用户">用户</option>
                </select>

                <!-- 添加用户按钮 -->
                <button
                    @click="openModal()"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-lg transition duration-200 flex items-center gap-2 font-medium"
                >
                    <i class="fas fa-plus"></i> 添加用户
                </button>
            </div>
        </div>

        <!-- 数据表格 -->
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
            <!-- 表格头部 -->
            <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                <h2 class="text-lg font-semibold text-gray-800">
                    用户列表 <span class="text-sm text-gray-500 font-normal">({{ filteredUsers.length }} 条记录)</span>
                </h2>
                <div class="flex items-center gap-2 text-sm text-gray-600">
                    <span>排序：</span>
                    <button
                        @click="sortBy('name')"
                        :class="['px-3 py-1 rounded', sortField === 'name' ? 'bg-blue-100 text-blue-700' : 'hover:bg-gray-100']"
                    >
                        姓名 <i v-if="sortField === 'name'" :class="['fas', sortOrder === 'asc' ? 'fa-arrow-up' : 'fa-arrow-down']"></i>
                    </button>
                    <button
                        @click="sortBy('createdAt')"
                        :class="['px-3 py-1 rounded', sortField === 'createdAt' ? 'bg-blue-100 text-blue-700' : 'hover:bg-gray-100']"
                    >
                        创建时间 <i v-if="sortField === 'createdAt'" :class="['fas', sortOrder === 'asc' ? 'fa-arrow-up' : 'fa-arrow-down']"></i>
                    </button>
                </div>
            </div>

            <!-- 表格内容 -->
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50 border-b border-gray-200">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ID
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                用户信息
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                角色
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                状态
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                创建时间
                            </th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                操作
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr v-for="user in paginatedUsers" :key="user.id" class="hover:bg-gray-50 transition">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                #{{ user.id }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 h-10 w-10 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center text-white font-semibold">
                                        {{ user.name.charAt(0) }}
                                    </div>
                                    <div class="ml-4">
                                        <div class="text-sm font-medium text-gray-900">{{ user.name }}</div>
                                        <div class="text-sm text-gray-500">{{ user.email }}</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span
                                    :class="[
                                        'px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full',
                                        user.role === '管理员' ? 'bg-purple-100 text-purple-800' :
                                        user.role === '编辑' ? 'bg-blue-100 text-blue-800' :
                                        'bg-gray-100 text-gray-800'
                                    ]"
                                >
                                    {{ user.role }}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span
                                    :class="[
                                        'px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full',
                                        user.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                    ]"
                                >
                                    {{ user.status === 'active' ? '活跃' : '禁用' }}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                {{ user.createdAt }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <button
                                    @click="openModal(user)"
                                    class="text-blue-600 hover:text-blue-900 mr-3"
                                    title="编辑"
                                >
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button
                                    @click="deleteUser(user.id)"
                                    class="text-red-600 hover:text-red-900"
                                    title="删除"
                                >
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 分页 -->
            <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                <div class="text-sm text-gray-700">
                    显示第 {{ (currentPage - 1) * pageSize + 1 }} - {{ Math.min(currentPage * pageSize, filteredUsers.length) }} 条，
                    共 {{ filteredUsers.length }} 条
                </div>
                <div class="flex gap-2">
                    <button
                        @click="currentPage--"
                        :disabled="currentPage === 1"
                        :class="[
                            'px-3 py-1 rounded border',
                            currentPage === 1
                                ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                                : 'bg-white text-gray-700 hover:bg-gray-50'
                        ]"
                    >
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button
                        v-for="page in totalPages"
                        :key="page"
                        @click="currentPage = page"
                        :class="[
                            'px-3 py-1 rounded border',
                            currentPage === page
                                ? 'bg-blue-600 text-white'
                                : 'bg-white text-gray-700 hover:bg-gray-50'
                        ]"
                    >
                        {{ page }}
                    </button>
                    <button
                        @click="currentPage++"
                        :disabled="currentPage === totalPages"
                        :class="[
                            'px-3 py-1 rounded border',
                            currentPage === totalPages
                                ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                                : 'bg-white text-gray-700 hover:bg-gray-50'
                        ]"
                    >
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- 模态框 -->
        <transition name="modal">
            <div v-if="showModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="closeModal">
                <transition name="modal-content">
                    <div v-if="showModal" class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
                        <!-- 模态框标题 -->
                        <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">
                                {{ editingUser ? '编辑用户' : '添加用户' }}
                            </h3>
                            <button @click="closeModal" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <!-- 表单 -->
                        <form @submit.prevent="saveUser" class="p-6 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">姓名</label>
                                <input
                                    v-model="formData.name"
                                    type="text"
                                    required
                                    class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="请输入姓名"
                                >
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">邮箱</label>
                                <input
                                    v-model="formData.email"
                                    type="email"
                                    required
                                    class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="请输入邮箱"
                                >
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">角色</label>
                                <select
                                    v-model="formData.role"
                                    required
                                    class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="管理员">管理员</option>
                                    <option value="编辑">编辑</option>
                                    <option value="用户">用户</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">状态</label>
                                <select
                                    v-model="formData.status"
                                    required
                                    class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="active">活跃</option>
                                    <option value="inactive">禁用</option>
                                </select>
                            </div>

                            <div class="flex gap-3 pt-4">
                                <button
                                    type="button"
                                    @click="closeModal"
                                    class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition duration-200"
                                >
                                    取消
                                </button>
                                <button
                                    type="submit"
                                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-200"
                                >
                                    保存
                                </button>
                            </div>
                        </form>
                    </div>
                </transition>
            </div>
        </transition>
    </div>

    <script>
        const { createApp, ref, computed, reactive } = Vue;

        createApp({
            setup() {
                // 响应式数据
                const users = ref([
                    { id: 1, name: '张三', email: 'zhang@example.com', role: '管理员', status: 'active', createdAt: '2025-01-15' },
                    { id: 2, name: '李四', email: 'li@example.com', role: '编辑', status: 'active', createdAt: '2025-02-20' },
                    { id: 3, name: '王五', email: 'wang@example.com', role: '用户', status: 'active', createdAt: '2025-03-10' },
                    { id: 4, name: '赵六', email: 'zhao@example.com', role: '用户', status: 'inactive', createdAt: '2025-04-05' },
                    { id: 5, name: '孙七', email: 'sun@example.com', role: '编辑', status: 'active', createdAt: '2025-05-12' },
                    { id: 6, name: '周八', email: 'zhou@example.com', role: '用户', status: 'active', createdAt: '2025-06-18' },
                    { id: 7, name: '吴九', email: 'wu@example.com', role: '管理员', status: 'active', createdAt: '2025-07-22' },
                    { id: 8, name: '郑十', email: 'zheng@example.com', role: '用户', status: 'inactive', createdAt: '2025-08-30' }
                ]);

                const searchQuery = ref('');
                const filterRole = ref('');
                const sortField = ref('createdAt');
                const sortOrder = ref('desc');
                const currentPage = ref(1);
                const pageSize = 5;

                const showModal = ref(false);
                const editingUser = ref(null);
                const formData = reactive({
                    name: '',
                    email: '',
                    role: '用户',
                    status: 'active'
                });

                // 计算属性
                const filteredUsers = computed(() => {
                    let result = users.value;

                    // 搜索过滤
                    if (searchQuery.value) {
                        const query = searchQuery.value.toLowerCase();
                        result = result.filter(user =>
                            user.name.toLowerCase().includes(query) ||
                            user.email.toLowerCase().includes(query)
                        );
                    }

                    // 角色过滤
                    if (filterRole.value) {
                        result = result.filter(user => user.role === filterRole.value);
                    }

                    // 排序
                    result = [...result].sort((a, b) => {
                        const aVal = a[sortField.value];
                        const bVal = b[sortField.value];
                        const order = sortOrder.value === 'asc' ? 1 : -1;
                        return aVal > bVal ? order : aVal < bVal ? -order : 0;
                    });

                    return result;
                });

                const totalPages = computed(() => Math.ceil(filteredUsers.value.length / pageSize));

                const paginatedUsers = computed(() => {
                    const start = (currentPage.value - 1) * pageSize;
                    const end = start + pageSize;
                    return filteredUsers.value.slice(start, end);
                });

                // 方法
                const sortBy = (field) => {
                    if (sortField.value === field) {
                        sortOrder.value = sortOrder.value === 'asc' ? 'desc' : 'asc';
                    } else {
                        sortField.value = field;
                        sortOrder.value = 'asc';
                    }
                };

                const openModal = (user = null) => {
                    editingUser.value = user;
                    if (user) {
                        Object.assign(formData, user);
                    } else {
                        formData.name = '';
                        formData.email = '';
                        formData.role = '用户';
                        formData.status = 'active';
                    }
                    showModal.value = true;
                };

                const closeModal = () => {
                    showModal.value = false;
                    editingUser.value = null;
                };

                const saveUser = () => {
                    if (editingUser.value) {
                        // 编辑用户
                        const index = users.value.findIndex(u => u.id === editingUser.value.id);
                        if (index !== -1) {
                            users.value[index] = { ...users.value[index], ...formData };
                        }
                    } else {
                        // 添加新用户
                        const newUser = {
                            id: Math.max(...users.value.map(u => u.id)) + 1,
                            ...formData,
                            createdAt: new Date().toISOString().split('T')[0]
                        };
                        users.value.unshift(newUser);
                    }
                    closeModal();
                };

                const deleteUser = (id) => {
                    if (confirm('确定要删除这个用户吗？')) {
                        users.value = users.value.filter(u => u.id !== id);
                    }
                };

                return {
                    users,
                    searchQuery,
                    filterRole,
                    sortField,
                    sortOrder,
                    currentPage,
                    pageSize,
                    showModal,
                    editingUser,
                    formData,
                    filteredUsers,
                    totalPages,
                    paginatedUsers,
                    sortBy,
                    openModal,
                    closeModal,
                    saveUser,
                    deleteUser
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
