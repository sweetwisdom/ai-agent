# 6A 工作流 · 详细参考

本文档为 6A 工作流各阶段步骤、质量门控及文档规范的完整说明。

---

## 阶段 1：Align（对齐阶段）

**目标：** 模糊需求 → 精确规范

### 执行步骤

1. **项目上下文分析**
   - 分析项目结构、技术栈、架构模式、依赖
   - 分析现有代码模式、文档与约定
   - 理解业务域与数据模型

2. **需求理解确认**
   - 先按「项目文档读取规则」阅读相关文档
   - 创建 `docs/任务名/ALIGNMENT_[任务名].md`，包含：
     - 项目与任务特性规范
     - 原始需求、边界确认、需求理解、疑问澄清
     - 引用已读文档及如何基于文档理解需求

3. **智能决策策略**
   - 识别歧义与不确定性
   - 生成按优先级排序的结构化问题清单
   - 优先基于项目内容与行业知识在文档中作答
   - 对人员倾向或不确定的问题主动中断并询问关键决策点
   - 根据回答更新理解与规范

4. **中断并询问关键决策点**
   - 主动中断、迭代执行智能决策策略

5. **最终共识**
   - 生成 `docs/任务名/CONSENSUS_[任务名].md`，包含：
     - 明确需求描述与验收标准
     - 技术实现方案、技术约束与集成方案
     - 任务边界与验收标准
     - 确认所有不确定性已解决

### 质量门控（Align）

- 需求边界清晰无歧义
- 技术方案与现有架构对齐
- 验收标准具体可测
- 关键假设已确认
- 项目特性规范已对齐

---

## 阶段 2：Architect（架构阶段）

**目标：** 共识文档 → 系统架构 → 模块设计 → 接口规范

### 执行步骤

1. **系统分层设计**
   - 基于 CONSENSUS、ALIGNMENT 设计架构
   - 生成 `docs/任务名/DESIGN_[任务名].md`，包含：
     - 整体架构图（mermaid）
     - 分层设计与核心组件
     - 模块依赖关系图
     - 接口契约
     - 数据流向图
     - 异常处理策略

2. **设计原则**
   - 严格限定在任务范围内，避免过度设计
   - 与现有系统架构一致
   - 复用现有组件与模式

### 质量门控（Architect）

- 架构图清晰准确
- 接口定义完整
- 与现有系统无冲突
- 设计可行性可验证

---

## 阶段 3：Atomize（原子化阶段）

**目标：** 架构设计 → 拆分任务 → 明确接口 → 依赖关系

### 执行步骤

1. **子任务拆分**
   - 基于 DESIGN 生成 `docs/任务名/TASK_[任务名].md`
   - 每个原子任务包含：
     - **输入契约**：前置依赖、输入数据、环境依赖
     - **输出契约**：输出数据、交付物、验收标准
     - **实现约束**：技术栈、接口规范、质量要求
     - **依赖关系**：后置任务、可并行任务

2. **拆分原则**
   - 复杂度可控，便于高成功率交付
   - 按功能模块分解，保证原子性与独立性
   - 验收标准明确，尽量可独立编译与测试
   - 依赖关系清晰

3. **生成任务依赖图**
   - 使用 mermaid 绘制依赖图

### 质量门控（Atomize）

- 任务覆盖完整需求
- 依赖无循环
- 每个任务可独立验证
- 复杂度评估合理

---

## 阶段 4：Approve（审批阶段）

**目标：** 原子任务 → 人工审查 → 迭代修改 → 按文档执行

### 执行步骤

1. **执行检查清单**
   - 完整性：任务计划覆盖所有需求
   - 一致性：与前期文档一致
   - 可行性：技术方案可行
   - 可控性：风险可接受、复杂度可控
   - 可测性：验收标准明确可执行

2. **最终确认清单**
   - 实现需求明确（无歧义）
   - 子任务定义明确
   - 边界与限制明确
   - 验收标准明确
   - 代码、测试、文档质量标准明确

---

## 阶段 5：Automate（自动化执行）

**目标：** 按节点执行 → 编写测试 → 实现代码 → 文档同步

### 执行步骤

1. **逐步实施子任务**
   - 创建并维护 `docs/任务名/ACCEPTANCE_[任务名].md` 记录完成情况

2. **代码质量要求**
   - 遵循项目现有代码规范与风格
   - 使用项目现有工具与库，复用现有组件
   - 代码精简易读
   - API KEY 仅放在 `.env`，不提交 git

3. **异常处理**
   - 遇到不确定问题立即中断
   - 在 TASK 文档中记录问题详情与位置
   - 待人工澄清后继续

4. **单任务执行流程**（按依赖顺序）
   - 执行前检查：验证输入契约、环境、依赖
   - 实现核心逻辑（按 DESIGN）
   - 编写单元测试（边界与异常）
   - 运行验证
   - 更新文档（见下方「文档新建/更新规则」）
   - 每完成一任务即验证

---

## 阶段 6：Assess（评估阶段）

**目标：** 执行结果 → 质量评估 → 文档更新 → 交付确认

### 执行步骤

1. **验证执行结果**
   - 更新 `docs/任务名/ACCEPTANCE_[任务名].md`
   - 整体验收：需求已实现、验收标准满足、编译通过、测试通过、与设计一致

2. **质量评估**
   - 代码质量、测试质量、文档质量、系统集成、无新增技术债务

3. **最终交付物**
   - 生成 `docs/任务名/FINAL_[任务名].md`（项目总结报告）
   - 生成 `docs/任务名/TODO_[任务名].md`（待办与缺失配置，便于后续处理）
   - 确保相关文档已创建/更新（遵循文档新建与更新规则）
   - 如需，更新 `docs/README.md` 索引

4. **TODO 询问**
   - 向用户说明 TODO 的解决方式，明确待办与缺失配置，并提供操作指引

---

## 文档读取规则（执行前）

1. 先读 `docs/README.md` 了解文档结构
2. 按任务类型阅读对应文档（见 SKILL.md「执行前必做」）
3. 理解现有文档中的技术决策与设计思路
4. 确保新实现与现有文档一致

---

## 文档新建规则

1. **分类与目录**
   - 任务文档：`docs/任务名/`，文件见 SKILL.md「任务文档目录与命名」
   - 项目文档：按类型放入 `docs/project/`、`docs/changelog/`、`docs/architecture/`、`docs/bugfix/`、`docs/features/`、`docs/performance/`、`docs/svg-parser/`、`docs/requirements/`

2. **命名**
   - 大写+下划线；Bug：`BUGFIX_V[版本].md` 或 `BUGFIX_[功能名].md`；功能：`[功能名]_FEATURE.md` 或 `[功能名].md`

3. **内容**
   - 含标题与创建日期；较长文档含目录；Markdown + 代码块标语言；架构图用 mermaid；风格与现有文档一致

4. **更新**
   - 代码变更同步更新相关文档；更新 `docs/changelog/CHANGELOG.md`；Bug/功能/架构变更更新对应目录

5. **索引**
   - 新建文档后如需，更新 `docs/README.md` 索引

---

## 进度与交互

- 显示当前阶段与步骤、完成情况、需关注的问题
- 中断时保存状态、记录问题、等待人工干预、从中断任务继续
